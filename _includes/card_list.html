<ul class="horizontal-list">
  {% for item in include.collection %}
    {% assign item_id = item.slug | default: item.title | slugify %}

    <li class="card" 
        role="button" 
        tabindex="0"
        onclick="openModal('modal-{{ item_id }}')"
        onkeypress="if(event.key==='Enter') openModal('modal-{{ item_id }}')">

      <div class="card-inner">
        <span class="header">
          {{ item.title }}
          {% if item.highlight %}
            <mark>{{ item.highlight }}</mark>
          {% endif %}
        </span>

        <hr />

        {% if item.desc %}
        <p class="body">{{ item.desc }}</p>
        {% endif %}
      </div>
    </li>
  {% endfor %}
</ul>

<!-- Modals -->
{% for item in include.collection %}
  {% assign item_id = item.slug | default: item.title | slugify %}

  <div id="modal-{{ item_id }}" class="modal" aria-hidden="true">
    
    <div class="modal-backdrop" onclick="closeModal('modal-{{ item_id }}')"></div>

    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('modal-{{ item_id }}')">&times;</button>

      <!-- Slider container -->
      <div class="modal-slides" data-active-slide="0">
        
        <!-- Slide 1 : title + desc -->
        <div class="modal-slide">
          <div class="card-inner">  <!-- peut-être à modifier avec modal-slide-content ? -->
              <span class="header">
                {{ item.title }}
                {% if item.highlight %}
                  <mark>{{ item.highlight }}</mark>
                {% endif %}
              </span>
          
              <hr />
          
              {% if item.desc %}
              <p class="body">{{ item.desc }}</p>
              {% endif %}
            </div>
        </div>

        <!-- Slide 2 : slide_1 -->
        {% if item.slide_1 %}
        <div class="modal-slide">
          <div class="modal-slide-content">
            {{ item.slide_1 | markdownify }}
          </div>
        </div>
        {% endif %}

        <!-- Slide 3 : slide_2 -->
        {% if item.slide_2 %}
        <div class="modal-slide">
          <div class="modal-slide-content">
            {{ item.slide_2 | markdownify }}
          </div>
        </div>
        {% endif %}

        <!-- Slide 4 : slide_3 -->
        {% if item.slide_3 %}
        <div class="modal-slide">
          <div class="modal-slide-content">
            {{ item.slide_3 | markdownify }}
          </div>
        </div>
        {% endif %}

      </div>

      <!-- Navigation boutons -->
      <div class="modal-slide-nav">
        <button class="button prev-slide" onclick="changeSlide('{{ item_id }}', -1)">‹</button>
        <button class="button next-slide" onclick="changeSlide('{{ item_id }}', 1)">›</button>
      </div>

    </div>
  </div>
{% endfor %}

<script>
//function openModal(id) {
  //const m = document.getElementById(id);
  //if (m) m.setAttribute('aria-hidden', 'false');
//}

//function closeModal(id) {
  //const m = document.getElementById(id);
  //if (!m) return;

  //m.setAttribute('aria-hidden', 'true');
  //resetSlides(m);
//}

function openModal(id) {
  const m = document.getElementById(id);
  if (!m) return;
  
  // 1. D'abord afficher (sans animation)
  m.style.display = 'flex';
  
  // 2. Attendre un tick pour déclencher l'animation
  setTimeout(() => {
    m.setAttribute('aria-hidden', 'false');
  }, 10);
}

function closeModal(id) {
  const m = document.getElementById(id);
  if (!m) return;
  
  // 1. Déclencher l'animation de fermeture
  m.setAttribute('aria-hidden', 'true');
  
  // 2. Attendre la fin de l'animation avant de cacher
  setTimeout(() => {
    m.style.display = 'none';
    resetSlides(m);
  }, 300); // 300ms = durée de ta transition CSS
}

function changeSlide(modalId, direction) {
  const container = document.querySelector('#modal-' + modalId + ' .modal-slides');
  updateSlide(container, direction);
}

// --- Fonctions utilitaires ---
  
function updateSlide(container, direction = 0) {
  const slides = container.querySelectorAll('.modal-slide');
  let index = parseInt(container.dataset.activeSlide) || 0;

  index = (index + direction + slides.length) % slides.length;
  container.dataset.activeSlide = index;

  slides.forEach((s, i) => {
    s.style.display = i === index ? 'block' : 'none';
  });
}

function resetSlides(modal) {
  const container = modal.querySelector('.modal-slides');
  if (!container) return;

  container.dataset.activeSlide = 0;
  updateSlide(container, 0);
}

// --- Initialisation ---
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".modal-slides").forEach(container => {
    container.dataset.activeSlide = 0;
    updateSlide(container, 0);
  });
});
</script>
