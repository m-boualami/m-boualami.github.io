<ul class="horizontal-list">
  {% for item in include.collection %}
    {% assign item_id = item.slug | default: item.title | slugify %}

    <li class="card" 
        role="button" 
        tabindex="0"
        onclick="openModal('modal-{{ item_id }}')"
        onkeypress="if(event.key==='Enter') openModal('modal-{{ item_id }}')">

      <div class="card-inner">
        <span class="header">
          {{ item.title }}
          {% if item.highlight %}
            <mark>{{ item.highlight }}</mark>
          {% endif %}
        </span>

        <hr />

        {% if item.desc %}
        <p class="body">{{ item.desc }}</p>
        {% endif %}
      </div>
    </li>
  {% endfor %}
</ul>

<!-- Modals -->
{% for item in include.collection %}
  {% assign item_id = item.slug | default: item.title | slugify %}

  <div id="modal-{{ item_id }}" class="modal" aria-hidden="true">
    
    <div class="modal-backdrop" onclick="closeModal('modal-{{ item_id }}')"></div>

    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('modal-{{ item_id }}')">&times;</button>

      <!-- Slider container -->
      <div class="modal-slides" data-active-slide="0">
        
        <!-- Slide 1 : title + desc -->
        <div class="modal-slide">
          <h2 class="modal-title" style="color: var(--links)">{{ item.title }}</h2>
          {% if item.desc %}
          <h3 class="modal-desc" style="color: var(--links)">{{ item.desc }}</h3>
          {% endif %}
        </div>

        <!-- Slide 2 : slide_1 -->
        {% if item.slide_1 %}
        <div class="modal-slide">
          <div class="modal-slide-content">
            {{ item.slide_1 | markdownify }}
          </div>
        </div>
        {% endif %}

        <!-- Slide 3 : slide_2 -->
        {% if item.slide_2 %}
        <div class="modal-slide">
          <div class="modal-slide-content">
            {{ item.slide_2 | markdownify }}
          </div>
        </div>
        {% endif %}

        <!-- Slide 4 : slide_3 -->
        {% if item.slide_3 %}
        <div class="modal-slide">
          <div class="modal-slide-content">
            {{ item.slide_3 | markdownify }}
          </div>
        </div>
        {% endif %}

      </div>

      <!-- Navigation boutons -->
      <div class="modal-slide-nav">
        <button class="button prev-slide" onclick="changeSlide('{{ item_id }}', -1)">‹</button>
        <button class="button next-slide" onclick="changeSlide('{{ item_id }}', 1)">›</button>
      </div>

      {% if item.external_link %}
      <p>
        <a class="button" href="{{ item.external_link }}" target="_blank">
          Voir le livrable
        </a>
      </p>
      {% endif %}
    </div>
  </div>
{% endfor %}

<script>
function openModal(id) {
  const m = document.getElementById(id);
  if (m) m.setAttribute('aria-hidden', 'false');
}

function closeModal(id) {
  const m = document.getElementById(id);
  if (m) m.setAttribute('aria-hidden', 'true');
}

function changeSlide(modalId, direction) {
  const container = document.querySelector('#modal-' + modalId + ' .modal-slides');
  const slides = container.querySelectorAll('.modal-slide');
  let index = parseInt(container.dataset.activeSlide);

  index = (index + direction + slides.length) % slides.length;
  container.dataset.activeSlide = index;

  slides.forEach((s, i) => {
    s.style.display = i === index ? 'block' : 'none';
  });
}

// Initialisation des slides au chargement
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".modal-slides").forEach(container => {
    const slides = container.querySelectorAll('.modal-slide');
    slides.forEach((s, i) => s.style.display = i === 0 ? 'block' : 'none');
    container.dataset.activeSlide = 0;
  });
});
</script>
